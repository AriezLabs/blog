<!DOCTYPE html>
<html lang="en-us">

<head>
  <title>Mac Mini Home Lab pt.2 | AriezLabs</title>

  <meta charset="UTF-8">
  <meta name="language" content="en">
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  
  
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Mac Mini Home Lab pt.2" />
  <meta name="twitter:description" content=""
  />
  <meta name="twitter:site" content="@https://twitter.com/&lt;your handle&gt;" />
  <meta name="twitter:creator" content="@https://twitter.com/&lt;your handle&gt;" />
  

  <link rel="shortcut icon" type="image/png" href="/favicon.ico" />

  
  
    
 
  
  
  
  
  
  
    
    <link rel="stylesheet" href="/css/post.min.3b28d14676e4769849164baf362f2b0aa069ab25702fef98f0c4227cb68d74cd.css" integrity="sha256-OyjRRnbkdphJFkuvNi8rCqBpqyVwL&#43;&#43;Y8MQifLaNdM0="/>
  
    
    <link rel="stylesheet" href="/css/custom.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css" integrity="sha256-47DEQpj8HBSa&#43;/TImW&#43;5JCeuQeRkm5NMpJWZG3hSuFU="/>
  
  
   
   
    

<script type="application/ld+json">
  
    {
      "@context" : "http://schema.org",
      "@type" : "BlogPosting",
      "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/ariezlabs.com\/"
      },
      "articleSection" : "blog",
      "name" : "Mac Mini Home Lab pt.2",
      "headline" : "Mac Mini Home Lab pt.2",
      "description" : "",
      "inLanguage" : "en-US",
      "author" : "",
      "creator" : "",
      "publisher": "",
      "accountablePerson" : "",
      "copyrightHolder" : "",
      "copyrightYear" : "2021",
      "datePublished": "2021-01-31 23:11:50 \u002b0100 CET",
      "dateModified" : "2021-01-31 23:11:50 \u002b0100 CET",
      "url" : "http:\/\/ariezlabs.com\/blog\/minihomelab\/",
      "wordCount" : "719",
      "keywords" : ["Blog"]
    }
  
  </script>
</head>

<body>
  <div class="burger__container">
  <div class="burger" aria-controls="navigation" aria-label="Menu">
    <div class="burger__meat burger__meat--1"></div>
    <div class="burger__meat burger__meat--2"></div>
    <div class="burger__meat burger__meat--3"></div>
  </div>
</div>
 

  <nav class="nav" role="navigation">
  <ul class="nav__list">
    
    
      <li>
        <a  href="/">about</a>
      </li>
    
      <li>
        <a  class="active"
         href="/blog">blog</a>
      </li>
    
  </ul>
</nav>


  <main>
    
    

    <div class="flex-wrapper">
      <div class="post__container">
        <div class="post">
          <header class="post__header">
            <h1 id="post__title">Mac Mini Home Lab pt.2</h1>
            <time datetime="2021-01-31 23:11:50 &#43;0100 CET" class="post__date"
            >Jan 31 2021</time>
          </header>
          <article class="post__content">
              
<p>This is an update pertaining to my <a href="../macmini/">last post</a>. Since then, I&rsquo;ve set up a couple useful services and built a primitive but dynamic landing page.</p>
<h2 id="setup">Setup<a class="anchor" href="#setup">#</a></h2>
<p>All the services are running their own servers, each listening on a different port. The landing page is powered by Node.js listening on port 80 and has links to everything else. Since some of the services are data intensive, I&rsquo;ve set up the landing page to display current disk usage. Everything is running on the Mac Mini, but is currently only accessible on my local network.</p>
<h3 id="archivebox">ArchiveBox<a class="anchor" href="#archivebox">#</a></h3>
<p>The first service I setup was <a href="https://github.com/ArchiveBox/ArchiveBox">ArchiveBox</a>. Personally, I&rsquo;m a small time data hoarder, so I really like having a personal offline internet archive. It&rsquo;s especially nice for my Zettelkasten since I know my local archive will still be there in however many years.</p>
<p>Setting up ArchiveBox is straightforward, and while its tendency to spout a lot of error messages onto your terminal doesn&rsquo;t inspire confidence everything works fine in the end.</p>
<h3 id="mopidy">Mopidy<a class="anchor" href="#mopidy">#</a></h3>
<p><a href="https://mopidy.com/">Mopidy</a> is a music server. It allows devices on your network to playback music on the host. I&rsquo;m running it on the Mini, which, in turn, has a shabby improvised speaker plugged in that actually works impressively well for what it is.</p>
<p><img src="../speaker.jpg" alt="speaker jpg"></p>
<p>(Come up with something better when you&rsquo;re quarantined in a college dorm with no tools but a screwdriver and scissors. I dare you.)</p>
<p>Mopidy can source songs from many places including local files, Spotify and Soundcloud, which is all I need. I&rsquo;m using the <a href="https://mopidy.com/ext/iris/">Iris</a> frontend. It&rsquo;s a little glitchy/laggy, but it generally works well and it&rsquo;s pretty. Overall, Mopidy has been very convenient as it democratizes the question of what songs to play at your next COVID party.</p>
<h3 id="zettelkasten">Zettelkasten<a class="anchor" href="#zettelkasten">#</a></h3>
<p>Finally, I wanted to host my Zettelkasten on the Mini as well. With <a href="https://www.npmjs.com/package/http-server">http-server</a>&rsquo;s stupidly simple setup, all it took was:</p>
<pre><code class="language-shell">$ npm install -g http-server
$ cd ~/Zettelkasten/
$ http-server
</code></pre>
<p>Done!</p>
<h3 id="landing-page">Landing page<a class="anchor" href="#landing-page">#</a></h3>
<p>To avoid having to manage a bunch of URLs, I thought setting up a simple landing page with links to all of the services would be a good idea. Plus it&rsquo;d be listening on port 80 so you could just go to <code>http://mini.local</code> without having to remember a particular port.</p>
<p>Since it worked so well for Zettelkasten, I started off using http-server and static HTML again. However, I progressively got more and more ideas and added more and more stuff until I was running a full blown webstack consisting of Node, Express, Vue and Bulma. The result still is simple:</p>
<p><img src="../landing.png" alt="landing jpeg"></p>
<p>But I switched to a dynamic site because I wanted disk usage visible on the page. Thanks to Vue and Express, this was a surprisingly viable project for a webdev noob like me. It&rsquo;s probably on the order of 100 lines of code (frontend plus backend), and I guess it qualifies as a nice dynamic website hello world. Plus it&rsquo;s actually useful!</p>
<p>Here&rsquo;s how I did it. First, have Express send a nice JSON object with disk usage stats when someone sends a request to <code>/du</code>:</p>
<pre><code class="language-javascript">app.get('/du', (req, res) =&gt; {
  exec(&quot;df -lh | grep disk1s1&quot;, (error, stdout, stderr) =&gt; {
      if (error) {
          console.log(`error: ${error.message}`);
          return;
      }
      if (stderr) {
          console.log(`stderr: ${stderr}`);
          return;
      }
      s = stdout.split(&quot; &quot;)
      res.send({
        disk:  s[0], // indices hardcoded to macOS's df format
        total: s[2],
        used:  s[5],
        free:  s[7],
        perc:  s[11],
      });
  });
})
</code></pre>
<p>The frontend requests this data on page load and passes the data on to Vue:</p>
<pre><code class="language-javascript">var du = new Vue({
  el: '#du',
  data: {
    disk:  &quot;0&quot;,
    total: &quot;0&quot;,
    used:  &quot;0&quot;,
    free:  &quot;0&quot;,
    perc:  &quot;0&quot;,
  }
})

fetch(&quot;du&quot;)
.then(data =&gt; { return data.json() })
.then(res =&gt; { 
  du.disk = res.disk
  du.total = res.total
  du.used = res.used
  du.free = res.free
  du.perc = res.perc
})
</code></pre>
<p>Then, just put an HTML element to display the data:</p>
<pre><code class="language-html">&lt;h1 id=&quot;du&quot;&gt;{{disk}}: {{used}}/{{total}} ({{perc}})&lt;/h1&gt;
</code></pre>
<p>and finally, it shows up like so:</p>
<pre><code>/dev/disk1s1: 37Gi/223Gi (17%)
</code></pre>
<h2 id="next-steps">Next steps<a class="anchor" href="#next-steps">#</a></h2>
<p>Reachability from the internet (with auth) would be very nice for Zettelkasten and ArchiveBox. I&rsquo;m not perfectly sure how to do this securely enough but I&rsquo;ve found some <a href="https://blog.prutser.net/2021/01/20/how-to-securely-self-host-a-website-or-web-app/">pointers</a>. Further, I&rsquo;m still waiting for the adapter for the second drive in order to get some more disk space. Once it&rsquo;s there I might also run a Nextcloud instance and setup a <a href="https://mosh.org/">mosh</a> server to use with my iPad.</p>


              
          </article>
          

<ul class="tags__list">
    
    <li class="tag__item">
        <a class="tag__link" href="http://ariezlabs.com/tags/fun/">fun</a>
    </li></ul>

 <div class="pagination">
  
    <a class="pagination__item" href="http://ariezlabs.com/blog/macmini/">
        <span class="pagination__label">Previous Post</span>
        <span class="pagination__title">Mac Mini Home Lab</span>
    </a>
  

  
    <a class="pagination__item" href="http://ariezlabs.com/blog/homelab3/">
      <span class="pagination__label">Next Post</span>
      <span class="pagination__title" >Homelab pt.3</a>
    </a>
  
</div>

          
          <footer class="post__footer">
            


<div class="social-icons">
  
     
    
      <a class="social-icons__link" title="Twitter"
         href="https://twitter.com/%3cyour%20handle%3e"
         target="_blank" rel="noopener">
        <div class="social-icons__icon" style="background-image: url('http://ariezlabs.com/images/social/twitter.svg')"></div>
      </a>
    
  
     
    
      <a class="social-icons__link" title="GitHub"
         href="https://github.com/AriezLabs"
         target="_blank" rel="noopener">
        <div class="social-icons__icon" style="background-image: url('http://ariezlabs.com/images/social/github.svg')"></div>
      </a>
    
  
     
    
  
     
    
  
     
    
  
     
    
  
     
    
  
     
    
     
</div>

            <p>Â© 2020</p>
          </footer>
          </div>
      </div>
      
    </div>
    

  </main>

   

  
  <script src="/js/index.min.49e4d8a384357d9b445b87371863419937ede9fa77737522ffb633073aebfa44.js" integrity="sha256-SeTYo4Q1fZtEW4c3GGNBmTft6fp3c3Ui/7YzBzrr&#43;kQ=" crossorigin="anonymous"></script>
  
  
  <script src="https://unpkg.com/prismjs@1.20.0/components/prism-core.min.js"></script>

  
  <script src="https://unpkg.com/prismjs@1.20.0/plugins/autoloader/prism-autoloader.min.js"
    data-autoloader-path="https://unpkg.com/prismjs@1.20.0/components/"></script>

  


</body>

</html>
